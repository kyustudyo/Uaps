<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URTS 강의 노트 4 - 강의 50-59</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .lecture-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .lecture-section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .lecture-content h3 {
            color: #34495e;
            font-size: 1.5rem;
            margin: 20px 0 15px 0;
        }

        .lecture-content h4 {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin: 15px 0 10px 0;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            margin: 20px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .code-block .keyword {
            color: #e74c3c;
            font-weight: bold;
        }

        .code-block .class-name {
            color: #f39c12;
            font-weight: bold;
        }

        .code-block .method-name {
            color: #9b59b6;
        }

        .code-block .property-name {
            color: #1abc9c;
        }

        .code-block .string {
            color: #2ecc71;
        }

        .code-block .number {
            color: #e67e22;
        }

        .code-block .comment {
            color: #95a5a6;
            font-style: italic;
        }

        .code-block .field-name {
            color: #3498db;
        }

        .info-box {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .content-list {
            list-style: none;
            padding-left: 0;
        }

        .content-list li {
            background: #ecf0f1;
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }

        .content-list li:hover {
            background: #d5dbdb;
            transform: translateX(5px);
        }

        .content-list li strong {
            color: #2c3e50;
        }

        .flow-diagram {
            background: #f8f9fa;
            border: 2px solid #34495e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .flow-step {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 10px;
            display: inline-block;
            font-weight: bold;
        }

        .flow-arrow {
            color: #e74c3c;
            font-size: 1.5rem;
            margin: 0 10px;
        }

        .table-of-contents {
            background: #f8f9fa;
            border: 2px solid #34495e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .table-of-contents h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .table-of-contents ul {
            list-style: none;
            padding-left: 0;
        }

        .table-of-contents li {
            margin: 8px 0;
        }

        .table-of-contents a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }

        .table-of-contents a:hover {
            color: #2980b9;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 URTS 강의 노트 4</h1>
            <p>Unity Real-Time Strategy Game - 강의 50-59</p>
        </div>

        <!-- 목차 -->
        <div class="table-of-contents">
            <h3>📋 목차</h3>
            <ul>
                <li><a href="#lecture-50">강의 50: Return Supplies - 자원 반환 시스템</a></li>
            </ul>
        </div>

        <!-- Lecture 50: Return Supplies -->
        <div class="lecture-section">
            <h2 id="lecture-50">강의 50: Return Supplies - 자원 반환 시스템</h2>
            
            <div class="lecture-content">
                <h3>🎯 왜 필요한가?</h3>
                <p>현재 Worker는 자원을 수집한 후 자동으로 Command Post로 돌아가지만, 플레이어가 직접 Command Post를 클릭해서 자원을 반환하도록 할 수 없습니다. StarCraft 2처럼 이미 자원을 가지고 있는 Worker가 Command Post를 클릭하면 바로 자원을 반환하고 다시 수집하러 가는 기능이 필요합니다.</p>
                
                <h3>🧠 초딩도 이해하기 쉬운 설명</h3>
                <p>마치 가방에 과자를 넣고 집에 가서 냉장고에 넣는 것과 같아요! Worker가 자원을 수집하면 가방(SupplyAmountHeld)에 넣고, Command Post(냉장고)를 클릭하면 바로 가서 자원을 넣고 다시 수집하러 가는 거예요!</p>
                
                <h3>🔧 핵심 구현</h3>
                
                <h4>1. UnitCommands 확장</h4>
                <p>새로운 명령 타입 추가:</p>
                
                <div class="code-block">
<span class="comment">// UnitCommands.cs - 유닛 명령 열거형 확장</span>
<span class="comment">// ReturnSupplies 명령 추가</span>

<span class="keyword">using</span> Unity.Behavior;

<span class="keyword">namespace</span> GameDevTV.RTS.Units
{
    <span class="comment">// BlackboardEnum: Unity Behavior Tree의 Blackboard에서 사용할 수 있도록 하는 속성</span>
    [BlackboardEnum]
    
    <span class="comment">// UnitCommands: 유닛이 수행할 수 있는 명령들의 열거형</span>
    <span class="keyword">public enum</span> <span class="class-name">UnitCommands</span>
    {
        <span class="comment">// Stop: 유닛을 정지시키는 명령</span>
        Stop,
        
        <span class="comment">// Move: 유닛을 이동시키는 명령</span>
        Move,
        
        <span class="comment">// Gather: 자원을 수집하는 명령</span>
        Gather,
        
        <span class="comment">// ReturnSupplies: 자원을 반환하는 명령 (새로 추가)</span>
        ReturnSupplies
    }
}</div>
                
                <h4>2. Worker 클래스 확장</h4>
                <p>자원 반환 기능 및 자원 보유 상태 확인:</p>
                
                <div class="code-block">
<span class="comment">// Worker.cs - 자원 반환 기능 추가</span>
<span class="comment">// HasSupplies 속성 및 ReturnSupplies 메서드</span>

<span class="keyword">using</span> GameDevTV.RTS.Behavior;
<span class="keyword">using</span> GameDevTV.RTS.Environment;
<span class="keyword">using</span> GameDevTV.RTS.EventBus;
<span class="keyword">using</span> GameDevTV.RTS.Events;
<span class="keyword">using</span> Unity.Behavior;
<span class="keyword">using</span> UnityEngine;

<span class="keyword">namespace</span> GameDevTV.RTS.Units
{
    <span class="comment">// Worker: AbstractUnit을 상속하고 IGatherer 인터페이스를 구현</span>
    <span class="keyword">public class</span> <span class="class-name">Worker</span> : <span class="class-name">AbstractUnit</span>, <span class="class-name">IGatherer</span>
    {
        <span class="comment">// HasSupplies: Worker가 자원을 가지고 있는지 확인하는 계산된 속성</span>
        <span class="comment">// public: 외부에서 접근 가능</span>
        <span class="comment">// bool: 불린형 (true/false)</span>
        <span class="comment">// { get; }: 읽기 전용 속성</span>
        <span class="keyword">public bool</span> <span class="property-name">HasSupplies</span> 
        {
            <span class="keyword">get</span> 
            {
                <span class="comment">// graphAgent != null: Behavior Tree 에이전트가 존재하는지 확인</span>
                <span class="comment">// GetVariable: Blackboard에서 변수 가져오기</span>
                <span class="comment">// "SupplyAmountHeld": 자원 보유량 변수 이름</span>
                <span class="comment">// out: 출력 매개변수로 변수에 값 할당</span>
                <span class="keyword">if</span> (<span class="field-name">graphAgent</span> != <span class="keyword">null</span> && 
                     <span class="field-name">graphAgent</span>.<span class="method-name">GetVariable</span>(<span class="string">"SupplyAmountHeld"</span>, 
                     <span class="keyword">out</span> <span class="class-name">BlackboardVariable</span>&lt;<span class="keyword">int</span>&gt; <span class="field-name">heldVariable</span>))
                {
                    <span class="comment">// heldVariable.Value > 0: 보유한 자원량이 0보다 큰지 확인</span>
                    <span class="keyword">return</span> <span class="field-name">heldVariable</span>.<span class="property-name">Value</span> > <span class="number">0</span>;
                }

                <span class="comment">// false: Behavior Tree 에이전트가 없거나 변수를 찾을 수 없음</span>
                <span class="keyword">return false</span>;
            }
        }

        <span class="comment">// Start: Unity 생명주기 메서드</span>
        <span class="comment">// protected override: 상위 클래스의 메서드를 재정의</span>
        <span class="keyword">protected override void</span> Start()
        {
            <span class="comment">// base.Start(): 상위 클래스의 Start 메서드 호출</span>
            <span class="keyword">base</span>.Start();
            
            <span class="comment">// GetVariable: Behavior Tree의 Blackboard에서 변수 가져오기</span>
            <span class="comment">// "GatherSuppliesEvent": Blackboard에 등록된 이벤트 채널 이름</span>
            <span class="keyword">if</span> (<span class="field-name">graphAgent</span>.<span class="method-name">GetVariable</span>(<span class="string">"GatherSuppliesEvent"</span>, 
                 <span class="keyword">out</span> <span class="class-name">BlackboardVariable</span>&lt;<span class="class-name">GatherSuppliesEventChannel</span>&gt; <span class="field-name">eventChannelVariable</span>))
            {
                <span class="comment">// Event +=: 이벤트에 핸들러 등록</span>
                <span class="comment">// HandleGatherSupplies: 이벤트 발생 시 호출될 메서드</span>
                <span class="field-name">eventChannelVariable</span>.<span class="property-name">Value</span>.<span class="property-name">Event</span> += HandleGatherSupplies;
            }
        }

        <span class="comment">// Gather: 자원 수집을 시작하는 메서드</span>
        <span class="comment">// public: 외부에서 호출 가능</span>
        <span class="comment">// void: 반환값 없음</span>
        <span class="comment">// GatherableSupply supply: 수집할 자원 객체</span>
        <span class="keyword">public void</span> <span class="method-name">Gather</span>(<span class="class-name">GatherableSupply</span> <span class="field-name">supply</span>)
        {
            <span class="comment">// SetVariableValue: Behavior Tree의 Blackboard에 변수 설정</span>
            <span class="comment">// "Supply": Blackboard 변수 이름</span>
            <span class="comment">// supply: 설정할 값 (GatherableSupply 객체)</span>
            <span class="field-name">graphAgent</span>.<span class="method-name">SetVariableValue</span>(<span class="string">"Supply"</span>, <span class="field-name">supply</span>);
            
            <span class="comment">// SetVariableValue: Behavior Tree의 Blackboard에 변수 설정</span>
            <span class="comment">// "TargetGameObject": Blackboard 변수 이름</span>
            <span class="comment">// supply.gameObject: 수집할 자원의 GameObject</span>
            <span class="field-name">graphAgent</span>.<span class="method-name">SetVariableValue</span>(<span class="string">"TargetGameObject"</span>, <span class="field-name">supply</span>.<span class="property-name">gameObject</span>);
            
            <span class="comment">// SetVariableValue: Behavior Tree의 Blackboard에 변수 설정</span>
            <span class="comment">// "Command": Blackboard 변수 이름</span>
            <span class="comment">// UnitCommands.Gather: 수집 명령</span>
            <span class="field-name">graphAgent</span>.<span class="method-name">SetVariableValue</span>(<span class="string">"Command"</span>, <span class="class-name">UnitCommands</span>.<span class="property-name">Gather</span>);
        }

        <span class="comment">// ReturnSupplies: 자원 반환을 시작하는 메서드 (새로 추가)</span>
        <span class="comment">// public: 외부에서 호출 가능</span>
        <span class="comment">// void: 반환값 없음</span>
        <span class="comment">// GameObject commandPost: 자원을 반환할 Command Post</span>
        <span class="keyword">public void</span> <span class="method-name">ReturnSupplies</span>(<span class="class-name">GameObject</span> <span class="field-name">commandPost</span>)
        {
            <span class="comment">// SetVariableValue: Behavior Tree의 Blackboard에 변수 설정</span>
            <span class="comment">// "CommandPost": Blackboard 변수 이름</span>
            <span class="comment">// commandPost: 설정할 값 (Command Post GameObject)</span>
            <span class="field-name">graphAgent</span>.<span class="method-name">SetVariableValue</span>(<span class="string">"CommandPost"</span>, <span class="field-name">commandPost</span>);
            
            <span class="comment">// SetVariableValue: Behavior Tree의 Blackboard에 변수 설정</span>
            <span class="comment">// "Command": Blackboard 변수 이름</span>
            <span class="comment">// UnitCommands.ReturnSupplies: 자원 반환 명령</span>
            <span class="field-name">graphAgent</span>.<span class="method-name">SetVariableValue</span>(<span class="string">"Command"</span>, <span class="class-name">UnitCommands</span>.<span class="property-name">ReturnSupplies</span>);
        }

        <span class="comment">// HandleGatherSupplies: Behavior Tree 이벤트 핸들러</span>
        <span class="comment">// private: 클래스 내부에서만 호출 가능</span>
        <span class="comment">// void: 반환값 없음</span>
        <span class="comment">// GameObject self: 이벤트를 발생시킨 객체</span>
        <span class="comment">// int amount: 수집한 자원의 양</span>
        <span class="comment">// SupplySO supply: 수집한 자원의 타입</span>
        <span class="keyword">private void</span> <span class="method-name">HandleGatherSupplies</span>(<span class="class-name">GameObject</span> <span class="field-name">self</span>, <span class="keyword">int</span> <span class="field-name">amount</span>, <span class="class-name">SupplySO</span> <span class="field-name">supply</span>)
        {
            <span class="comment">// Bus<SupplyEvent>.Raise: Event Bus를 통해 SupplyEvent 전송</span>
            <span class="comment">// new SupplyEvent: 새로운 SupplyEvent 인스턴스 생성</span>
            <span class="comment">// amount: 수집한 자원의 양</span>
            <span class="comment">// supply: 수집한 자원의 타입</span>
            <span class="class-name">Bus</span>&lt;<span class="class-name">SupplyEvent</span>&gt;.<span class="method-name">Raise</span>(<span class="keyword">new</span> <span class="class-name">SupplyEvent</span>(<span class="field-name">amount</span>, <span class="field-name">supply</span>));
        }
    }
}</div>
                
                <h4>3. GatherCommand 확장</h4>
                <p>Command Post 클릭 시 자원 반환 처리:</p>
                
                <div class="code-block">
<span class="comment">// GatherCommand.cs - 자원 수집 및 반환 명령 확장</span>
<span class="comment">// Command Post 클릭 시 자원 반환 기능 추가</span>

<span class="keyword">using</span> GameDevTV.RTS.Environment;
<span class="keyword">using</span> GameDevTV.RTS.Units;
<span class="keyword">using</span> UnityEngine;

<span class="keyword">namespace</span> GameDevTV.RTS.Commands
{
    <span class="comment">// CreateAssetMenu: Unity Inspector에서 ScriptableObject 생성 메뉴 추가</span>
    [CreateAssetMenu(fileName = <span class="string">"Gather Action"</span>, menuName = <span class="string">"AI/Commands/Gather"</span>, order = <span class="number">105</span>)]
    
    <span class="comment">// GatherCommand: 자원 수집 및 반환을 처리하는 명령 클래스</span>
    <span class="comment">// ActionBase: 모든 명령의 기본 클래스</span>
    <span class="keyword">public class</span> <span class="class-name">GatherCommand</span> : <span class="class-name">ActionBase</span>
    {
        <span class="comment">// commandPostSO: Command Post 유닛 타입</span>
        <span class="comment">// [SerializeField]: Unity Inspector에서 설정 가능</span>
        <span class="comment">// private: 클래스 내부에서만 접근 가능</span>
        <span class="comment">// UnitSO: 유닛 타입을 정의하는 ScriptableObject</span>
        [SerializeField] <span class="keyword">private</span> <span class="class-name">UnitSO</span> <span class="field-name">commandPostSO</span>;

        <span class="comment">// CanHandle: 명령을 처리할 수 있는지 확인하는 메서드</span>
        <span class="comment">// public override: 상위 클래스의 메서드를 재정의</span>
        <span class="comment">// bool: 반환 타입 (처리 가능 여부)</span>
        <span class="comment">// CommandContext context: 명령 컨텍스트 (유닛, 클릭 위치 등)</span>
        <span class="keyword">public override bool</span> <span class="method-name">CanHandle</span>(<span class="class-name">CommandContext</span> <span class="field-name">context</span>)
        {
            <span class="comment">// context.Commandable is Worker: 명령을 받을 수 있는 객체가 Worker인지 확인</span>
            <span class="comment">// context.Hit.collider != null: 클릭한 위치에 Collider가 있는지 확인</span>
            <span class="comment">// IsGatherableSupplyOrCommandPost: 자원 또는 Command Post인지 확인</span>
            <span class="keyword">return</span> <span class="field-name">context</span>.<span class="property-name">Commandable</span> <span class="keyword">is</span> <span class="class-name">Worker</span> 
                && <span class="field-name">context</span>.<span class="property-name">Hit</span>.<span class="property-name">collider</span> != <span class="keyword">null</span> 
                && <span class="method-name">IsGatherableSupplyOrCommandPost</span>(<span class="field-name">context</span>.<span class="property-name">Hit</span>.<span class="property-name">collider</span>);
        }

        <span class="comment">// Handle: 명령을 실제로 처리하는 메서드</span>
        <span class="comment">// public override: 상위 클래스의 메서드를 재정의</span>
        <span class="comment">// void: 반환값 없음</span>
        <span class="comment">// CommandContext context: 명령 컨텍스트</span>
        <span class="keyword">public override void</span> <span class="method-name">Handle</span>(<span class="class-name">CommandContext</span> <span class="field-name">context</span>)
        {
            <span class="comment">// Worker worker: 명령을 받을 Worker 객체</span>
            <span class="comment">// as Worker: Commandable을 Worker로 캐스팅</span>
            <span class="class-name">Worker</span> <span class="field-name">worker</span> = <span class="field-name">context</span>.<span class="property-name">Commandable</span> <span class="keyword">as</span> <span class="class-name">Worker</span>;
            
            <span class="comment">// TryGetComponent: Collider에서 GatherableSupply 컴포넌트를 가져옴</span>
            <span class="comment">// out supply: 가져온 GatherableSupply를 저장할 변수</span>
            <span class="keyword">if</span> (<span class="field-name">context</span>.<span class="property-name">Hit</span>.<span class="property-name">collider</span>.<span class="method-name">TryGetComponent</span>(<span class="keyword">out</span> <span class="class-name">GatherableSupply</span> <span class="field-name">supply</span>))
            {
                <span class="comment">// Gather: 자원 수집 시작</span>
                <span class="field-name">worker</span>.<span class="method-name">Gather</span>(<span class="field-name">supply</span>);
            }
            <span class="comment">// else if: 첫 번째 조건이 거짓일 때만 확인</span>
            <span class="comment">// IsCommandPost: Command Post인지 확인</span>
            <span class="comment">// worker.HasSupplies: Worker가 자원을 가지고 있는지 확인</span>
            <span class="keyword">else if</span> (<span class="method-name">IsCommandPost</span>(<span class="field-name">context</span>.<span class="property-name">Hit</span>.<span class="property-name">collider</span>) && <span class="field-name">worker</span>.<span class="property-name">HasSupplies</span>)
            {
                <span class="comment">// ReturnSupplies: 자원 반환 시작</span>
                <span class="comment">// context.Hit.collider.gameObject: 클릭한 Command Post의 GameObject</span>
                <span class="field-name">worker</span>.<span class="method-name">ReturnSupplies</span>(<span class="field-name">context</span>.<span class="property-name">Hit</span>.<span class="property-name">collider</span>.<span class="property-name">gameObject</span>);
            }
            <span class="comment">// else: 위의 모든 조건이 거짓일 때</span>
            <span class="keyword">else</span>
            {
                <span class="comment">// MoveTo: 해당 위치로 이동</span>
                <span class="comment">// context.Hit.collider.gameObject.transform.position: 클릭한 객체의 위치</span>
                <span class="field-name">worker</span>.<span class="method-name">MoveTo</span>(<span class="field-name">context</span>.<span class="property-name">Hit</span>.<span class="property-name">collider</span>.<span class="property-name">gameObject</span>.<span class="property-name">transform</span>.<span class="property-name">position</span>);
            }
        }

        <span class="comment">// IsGatherableSupplyOrCommandPost: 자원 또는 Command Post인지 확인하는 private 메서드</span>
        <span class="comment">// private: 클래스 내부에서만 호출 가능</span>
        <span class="comment">// bool: 반환 타입</span>
        <span class="comment">// Collider collider: 확인할 Collider</span>
        <span class="comment">// =>: 람다 표현식 (간단한 메서드 정의)</span>
        <span class="keyword">private bool</span> <span class="method-name">IsGatherableSupplyOrCommandPost</span>(<span class="class-name">Collider</span> <span class="field-name">collider</span>) => 
            <span class="field-name">collider</span>.<span class="method-name">TryGetComponent</span>(<span class="keyword">out</span> <span class="class-name">GatherableSupply</span> _) || 
            <span class="method-name">IsCommandPost</span>(<span class="field-name">collider</span>);
        
        <span class="comment">// IsCommandPost: Command Post인지 확인하는 private 메서드</span>
        <span class="keyword">private bool</span> <span class="method-name">IsCommandPost</span>(<span class="class-name">Collider</span> <span class="field-name">collider</span>) => 
            <span class="field-name">collider</span>.<span class="method-name">TryGetComponent</span>(<span class="keyword">out</span> <span class="class-name">BaseBuilding</span> <span class="field-name">building</span>) && 
            <span class="field-name">building</span>.<span class="property-name">UnitSO</span>.<span class="method-name">Equals</span>(<span class="field-name">commandPostSO</span>);
    }
}</div>
                
                <h3>🔄 동작 과정</h3>
                <ol>
                    <li><strong>Command Post 클릭</strong>: 플레이어가 자원을 가지고 있는 Worker로 Command Post 클릭</li>
                    <li><strong>조건 확인</strong>: GatherCommand에서 Worker가 자원을 가지고 있는지 확인</li>
                    <li><strong>자원 반환 명령</strong>: ReturnSupplies 메서드 호출</li>
                    <li><strong>Behavior Tree 실행</strong>: ReturnSupplies 명령으로 Behavior Tree 실행</li>
                    <li><strong>Command Post로 이동</strong>: SetAgentAvoidance → MoveToTargetGameObject</li>
                    <li><strong>자원 반환</strong>: RaiseEvent로 자원 반환 이벤트 발생</li>
                    <li><strong>다시 수집</strong>: 명령을 Gather로 변경하여 다시 수집 시작</li>
                </ol>
                
                <h3>🎮 게임에서의 효과</h3>
                <ul>
                    <li><strong>직관적인 상호작용</strong>: Command Post 클릭으로 자원 반환 가능</li>
                    <li><strong>StarCraft 2와 유사한 동작</strong>: 실제 RTS 게임과 같은 행동 패턴</li>
                    <li><strong>효율적인 자원 관리</strong>: 플레이어가 직접 자원 반환 시점 제어</li>
                    <li><strong>자동 수집 재개</strong>: 자원 반환 후 자동으로 다시 수집 시작</li>
                </ul>
                
                <h3>🔧 기술적 특징</h3>
                <ul>
                    <li><strong>계산된 속성</strong>: HasSupplies는 Blackboard 변수를 실시간으로 확인</li>
                    <li><strong>조건부 처리</strong>: 자원 보유 상태에 따른 다른 동작</li>
                    <li><strong>명령 체계 확장</strong>: 새로운 ReturnSupplies 명령 추가</li>
                    <li><strong>Behavior Tree 연동</strong>: 명령 변경으로 Behavior Tree 흐름 제어</li>
                    <li><strong>안전한 접근</strong>: null 체크 및 예외 상황 처리</li>
                </ul>
                
                <h3>📊 시스템 구조</h3>
                <div class="info-box">
                    <h4>🔄 자원 반환 흐름도</h4>
                    <ol>
                        <li><strong>Command Post 클릭</strong>: 플레이어가 Command Post 우클릭</li>
                        <li><strong>GatherCommand 확인</strong>: CanHandle에서 조건 확인</li>
                        <li><strong>자원 보유 확인</strong>: worker.HasSupplies 확인</li>
                        <li><strong>ReturnSupplies 호출</strong>: 자원 반환 명령 실행</li>
                        <li><strong>Behavior Tree 실행</strong>: ReturnSupplies 명령으로 트리 실행</li>
                        <li><strong>Command Post 이동</strong>: 목표 Command Post로 이동</li>
                        <li><strong>자원 반환</strong>: 이벤트 발생 및 자원 전달</li>
                        <li><strong>수집 재개</strong>: 명령을 Gather로 변경하여 수집 재시작</li>
                    </ol>
                </div>
                
                <h3>🎯 Behavior Tree 구조</h3>
                <div class="info-box">
                    <h4>🌳 ReturnSupplies 브랜치</h4>
                    <ol>
                        <li><strong>SetAgentAvoidance</strong>: 회피 품질을 0으로 설정 (다른 유닛 통과)</li>
                        <li><strong>MoveToTargetGameObject</strong>: Command Post로 이동</li>
                        <li><strong>RaiseEvent</strong>: 자원 반환 이벤트 발생</li>
                        <li><strong>SetVariableValue</strong>: 명령을 Gather로 변경</li>
                        <li><strong>Wait For Any</strong>: Gather 브랜치와 합치기</li>
                    </ol>
                </div>
                
                <h3>🔍 StarCraft 2 참고</h3>
                <div class="info-box">
                    <h4>🎮 StarCraft 2의 Worker 동작</h4>
                    <ul>
                        <li><strong>드론(Drone)</strong>: Zerg의 Worker 유닛</li>
                        <li><strong>Hatchery 클릭</strong>: Hatchery를 클릭하면 자원 반환</li>
                        <li><strong>자동 수집 재개</strong>: 자원 반환 후 자동으로 다시 수집</li>
                        <li><strong>효율적인 이동</strong>: 다른 유닛을 통과하며 이동</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
