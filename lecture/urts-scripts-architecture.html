<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URTS Scripts Architecture - Complete Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.5rem;
            margin: 20px 0 15px 0;
        }

        .section h4 {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin: 15px 0 10px 0;
        }

        .tech-stack {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .tech-stack h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .content-list {
            list-style: none;
            padding-left: 0;
        }

        .content-list li {
            background: #ecf0f1;
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }

        .content-list li:hover {
            background: #d5dbdb;
            transform: translateX(5px);
        }

        .content-list li strong {
            color: #2c3e50;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            margin: 20px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .code-block .keyword {
            color: #e74c3c;
            font-weight: bold;
        }

        .code-block .class-name {
            color: #f39c12;
            font-weight: bold;
        }

        .code-block .method-name {
            color: #9b59b6;
        }

        .code-block .property-name {
            color: #1abc9c;
        }

        .code-block .string {
            color: #2ecc71;
        }

        .code-block .number {
            color: #e67e22;
        }

        .code-block .comment {
            color: #95a5a6;
            font-style: italic;
        }

        .code-block .field-name {
            color: #3498db;
        }

        .info-box {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .flow-diagram {
            background: #f8f9fa;
            border: 2px solid #34495e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .flow-step {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 10px;
            display: inline-block;
            font-weight: bold;
        }

        .flow-arrow {
            color: #e74c3c;
            font-size: 1.5rem;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏗️ URTS Scripts Architecture</h1>
            <p>Unity Real-Time Strategy Game - Complete Technical Architecture Guide</p>
        </div>

        <!-- 핵심 기술 개념 -->
        <div class="section">
            <h2>🔧 핵심 기술 개념</h2>
            
            <div class="tech-stack">
                <h4>🎮 Unity Behavior Tree 시스템</h4>
                <ul class="content-list">
                    <li><strong>BehaviorGraphAgent</strong>: Behavior Tree 실행 엔진</li>
                    <li><strong>Blackboard</strong>: Behavior Tree 데이터 저장소</li>
                    <li><strong>Custom Action Nodes</strong>: 커스텀 액션 노드들</li>
                    <li><strong>Switch Node</strong>: 명령에 따른 분기 처리</li>
                    <li><strong>Abort Node</strong>: 명령 변경 시 즉시 중단</li>
                    <li><strong>Conditional Branch</strong>: 조건부 분기 처리</li>
                    <li><strong>Wait For Any/All</strong>: 병렬 실행 및 경로 합치기</li>
                </ul>
            </div>

            <div class="tech-stack">
                <h4>🎯 커스텀 Behavior Tree 노드들</h4>
                <ul class="content-list">
                    <li><strong>MoveToTargetLocationAction</strong>: 목표 위치로 이동</li>
                    <li><strong>MoveToTargetGameObjectAction</strong>: GameObject로 이동 (Collider.ClosestPoint 활용)</li>
                    <li><strong>MoveToGatherableSupplyAction</strong>: 지능적인 자원 이동 (자동 재타겟팅)</li>
                    <li><strong>StopAgentAction</strong>: NavMesh Agent 정지</li>
                    <li><strong>GatherSuppliesAction</strong>: 자원 수집 액션</li>
                    <li><strong>FindClosestCommandPostAction</strong>: 가장 가까운 Command Post 찾기</li>
                    <li><strong>SetAgentAvoidanceAction</strong>: 동적 회피 품질 설정</li>
                </ul>
            </div>

            <div class="tech-stack">
                <h4>🎮 게임 시스템</h4>
                <ul class="content-list">
                    <li><strong>UnitCommands</strong>: 유닛 명령 열거형 (Stop, Move, Gather, ReturnSupplies)</li>
                    <li><strong>Command Pattern</strong>: ICommand 인터페이스 및 ActionBase ScriptableObjects</li>
                    <li><strong>Event Bus</strong>: 전역 이벤트 시스템</li>
                    <li><strong>Supply System</strong>: 자원 수집 및 관리 시스템</li>
                    <li><strong>Player Supplies</strong>: 플레이어 자원 관리 (정적 변수)</li>
                    <li><strong>Animation Synchronization</strong>: Behavior Tree와 애니메이션 동기화</li>
                    <li><strong>Behavior Events</strong>: Behavior Tree 이벤트 시스템</li>
                    <li><strong>Return Supplies</strong>: 자원 반환 시스템</li>
                    <li><strong>Override Commands</strong>: 동적 명령 변경 시스템</li>
                    <li><strong>AbstractUnitSO</strong>: 유닛과 건물의 공통 기본 클래스</li>
                    <li><strong>Building Ghost Material</strong>: 건물 배치 시각화</li>
                </ul>
        </div>

            <div class="tech-stack">
                <h4>🔧 유틸리티 및 최적화</h4>
                <ul class="content-list">
                    <li><strong>AnimationConstants</strong>: 애니메이션 파라미터 해시 캐싱</li>
                    <li><strong>ClosestColliderComparer</strong>: 거리 기준 Collider 정렬</li>
                    <li><strong>LINQ Integration</strong>: 효율적인 컬렉션 처리</li>
                    <li><strong>Guardian Pattern</strong>: null 체크 및 안전한 접근</li>
                    <li><strong>Update Loop Removal</strong>: 성능 최적화를 위한 Update 제거</li>
                </ul>
            </div>
        </div>

        <!-- 시스템 아키텍처 -->
        <div class="section">
            <h2>🏛️ 시스템 아키텍처</h2>
            
            <div class="flow-diagram">
                <h3>🔄 전체 시스템 흐름</h3>
                <div class="flow-step">Player Input</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Command System</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Behavior Tree</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Unit Actions</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Event Bus</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Game Systems</div>
            </div>

            <div class="info-box">
                <h4>📊 핵심 컴포넌트 관계</h4>
                <ol>
                    <li><strong>PlayerInput</strong>: 사용자 입력 처리 및 명령 생성</li>
                    <li><strong>AbstractUnit</strong>: 모든 유닛의 기본 클래스</li>
                    <li><strong>Worker</strong>: 자원 수집 전용 유닛</li>
                    <li><strong>BehaviorGraphAgent</strong>: Behavior Tree 실행 엔진</li>
                    <li><strong>Blackboard</strong>: Behavior Tree 데이터 저장소</li>
                    <li><strong>Event Bus</strong>: 시스템 간 통신</li>
                    <li><strong>Supplies</strong>: 플레이어 자원 관리</li>
                </ol>
                </div>
            </div>

        <!-- Behavior Tree 구조 -->
        <div class="section">
            <h2>🌳 Behavior Tree 구조</h2>
            
            <div class="info-box">
                <h4>🎯 Worker Behavior Tree (강의 49 기준)</h4>
                <ol>
                    <li><strong>Switch (Command)</strong>: 명령에 따른 분기</li>
                    <li><strong>Stop</strong>: StopAgentAction</li>
                    <li><strong>Move</strong>: MoveToTargetLocationAction</li>
                    <li><strong>Gather</strong>: 조건부 분기 시스템</li>
                    <ul>
                        <li><strong>SetAgentAvoidance</strong>: 회피 품질 설정</li>
                        <li><strong>MoveToGatherableSupply</strong>: 자원으로 이동</li>
                        <li><strong>Conditional Branch</strong>: SupplyAmountHeld 확인</li>
                        <ul>
                            <li><strong>True (자원 없음)</strong>: GatherSupplies</li>
                            <li><strong>False (자원 있음)</strong>: 수집 생략</li>
                        </ul>
                        <li><strong>Wait For Any</strong>: 경로 합치기</li>
                        <li><strong>FindClosestCommandPost</strong>: Command Post 찾기</li>
                        <li><strong>MoveToTargetGameObject</strong>: Command Post로 이동</li>
                        <li><strong>RaiseEvent</strong>: 수집 완료 이벤트</li>
                    </ul>
                </ol>
            </div>

            <div class="tech-stack">
                <h4>🔧 Behavior Tree 노드 타입</h4>
                <ul class="content-list">
                    <li><strong>Control Flow</strong>: Switch, Sequence, Conditional Branch</li>
                    <li><strong>Action Nodes</strong>: 커스텀 액션 노드들</li>
                    <li><strong>Flow Control</strong>: Wait For Any/All, Abort</li>
                    <li><strong>Event Nodes</strong>: RaiseEvent, EventChannel</li>
                </ul>
            </div>
        </div>

        <!-- 자원 수집 시스템 -->
        <div class="section">
            <h2>⛏️ 자원 수집 시스템</h2>
            
            <div class="flow-diagram">
                <h3>🔄 자원 수집 흐름</h3>
                <div class="flow-step">Gather 명령</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">자원으로 이동</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">조건 확인</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">수집 또는 생략</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Command Post로 이동</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">이벤트 발생</div>
            </div>

            <div class="info-box">
                <h4>🎮 자원 수집 특징</h4>
                <ul>
                    <li><strong>지능적인 수집</strong>: 이미 자원을 가지고 있으면 수집하지 않음</li>
                    <li><strong>자동 재타겟팅</strong>: 자원이 사용 중이면 다른 자원 찾기</li>
                    <li><strong>Collider.ClosestPoint</strong>: 정확한 위치 계산</li>
                    <li><strong>동적 회피</strong>: 수집 시 회피 품질 조정</li>
                    <li><strong>애니메이션 동기화</strong>: 수집 상태에 따른 애니메이션</li>
                </ul>
            </div>
        </div>

        <!-- 이벤트 시스템 -->
        <div class="section">
            <h2>📡 이벤트 시스템</h2>
            
            <div class="tech-stack">
                <h4>🎯 Event Bus 시스템</h4>
                <ul class="content-list">
                    <li><strong>SupplyEvent</strong>: 자원 수집 이벤트</li>
                    <li><strong>UnitSelectedEvent</strong>: 유닛 선택 이벤트</li>
                    <li><strong>UnitDeselectedEvent</strong>: 유닛 선택 해제 이벤트</li>
                    <li><strong>UnitSpawnEvent</strong>: 유닛 생성 이벤트</li>
                </ul>
        </div>

            <div class="tech-stack">
                <h4>🎮 Behavior Events</h4>
                <ul class="content-list">
                    <li><strong>GatherSuppliesEventChannel</strong>: Behavior Tree 이벤트 채널</li>
                    <li><strong>EventChannelBase</strong>: 이벤트 채널 기본 클래스</li>
                    <li><strong>델리게이트 시스템</strong>: Behavior Tree와 게임 코드 간 통신</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>🔄 이벤트 흐름</h4>
                <ol>
                    <li><strong>Behavior Tree</strong>: GatherSuppliesEventChannel 이벤트 발생</li>
                    <li><strong>Worker</strong>: 이벤트 수신 및 SupplyEvent 생성</li>
                    <li><strong>Event Bus</strong>: SupplyEvent 전송</li>
                    <li><strong>Supplies</strong>: 이벤트 수신 및 UI 업데이트</li>
                </ol>
            </div>
        </div>

        <!-- 확장 가능한 구조 -->
        <div class="section">
            <h2>🚀 확장 가능한 구조</h2>
            
            <div class="tech-stack">
                <h4>🎯 새로운 유닛 추가</h4>
                <ul class="content-list">
                    <li><strong>AbstractUnit 상속</strong>: 기본 유닛 기능 상속</li>
                    <li><strong>UnitSO 설정</strong>: ScriptableObject로 유닛 정의</li>
                    <li><strong>Behavior Tree 생성</strong>: 유닛별 Behavior Tree 설계</li>
                    <li><strong>커스텀 액션 노드</strong>: 필요시 새로운 액션 노드 생성</li>
                </ul>
            </div>

            <div class="tech-stack">
                <h4>🎮 새로운 명령 추가</h4>
                <ul class="content-list">
                    <li><strong>UnitCommands 확장</strong>: 열거형에 새 명령 추가</li>
                    <li><strong>ActionBase 상속</strong>: 새 명령 ScriptableObject 생성</li>
                    <li><strong>Behavior Tree 업데이트</strong>: Switch 노드에 새 케이스 추가</li>
                    <li><strong>커스텀 액션 노드</strong>: 필요시 새로운 액션 노드 생성</li>
            </ul>
            </div>

            <div class="tech-stack">
                <h4>🔧 새로운 자원 타입</h4>
                <ul class="content-list">
                    <li><strong>SupplySO 생성</strong>: 새 자원 타입 정의</li>
                    <li><strong>GatherableSupply 설정</strong>: 자원 GameObject 설정</li>
                    <li><strong>Supplies 클래스 확장</strong>: 새 자원 타입 처리</li>
                    <li><strong>UI 업데이트</strong>: 새 자원 표시 UI 추가</li>
                </ul>
            </div>
        </div>

        <!-- 성능 최적화 -->
        <div class="section">
            <h2>⚡ 성능 최적화</h2>
            
            <div class="info-box">
                <h4>🎯 최적화 기법</h4>
                <ul>
                    <li><strong>AnimationConstants</strong>: Animator.StringToHash로 파라미터 해시 캐싱</li>
                    <li><strong>Update Loop Removal</strong>: MonoBehaviour의 Update 메서드 제거</li>
                    <li><strong>LINQ 최적화</strong>: 효율적인 컬렉션 처리</li>
                    <li><strong>정적 변수 활용</strong>: 전역 접근 가능한 자원 관리</li>
                    <li><strong>이벤트 기반 통신</strong>: 직접 참조 대신 이벤트 사용</li>
                    <li><strong>Behavior Tree 최적화</strong>: 조건부 분기로 불필요한 실행 방지</li>
                </ul>
            </div>

            <div class="tech-stack">
                <h4>🔧 메모리 관리</h4>
                <ul class="content-list">
                    <li><strong>이벤트 구독 해제</strong>: OnDestroy에서 이벤트 해제</li>
                    <li><strong>null 체크</strong>: Guardian Pattern으로 안전한 접근</li>
                    <li><strong>자원 해제</strong>: AbortGather로 자원 상태 관리</li>
                    <li><strong>구조체 활용</strong>: ClosestColliderComparer로 메모리 효율성</li>
                </ul>
            </div>
        </div>

        <!-- 개발 가이드 -->
        <div class="section">
            <h2>📚 개발 가이드</h2>
            
            <div class="info-box">
                <h4>🎯 새로운 기능 추가 시 체크리스트</h4>
                <ol>
                    <li><strong>Behavior Tree 설계</strong>: 필요한 노드와 흐름 설계</li>
                    <li><strong>커스텀 액션 노드</strong>: 필요시 새로운 액션 노드 생성</li>
                    <li><strong>이벤트 시스템</strong>: Behavior Tree와 게임 코드 간 통신</li>
                    <li><strong>애니메이션 동기화</strong>: Behavior Tree 액션과 애니메이션 연결</li>
                    <li><strong>성능 최적화</strong>: Update 루프 제거 및 효율적인 처리</li>
                    <li><strong>에러 처리</strong>: null 체크 및 예외 상황 처리</li>
                </ol>
            </div>

            <div class="tech-stack">
                <h4>🎮 디버깅 팁</h4>
                <ul class="content-list">
                    <li><strong>Behavior Tree 에디터</strong>: 시각적 디버깅 활용</li>
                    <li><strong>Blackboard 모니터링</strong>: 변수 상태 확인</li>
                    <li><strong>이벤트 로깅</strong>: Event Bus 이벤트 추적</li>
                    <li><strong>Unity Profiler</strong>: 성능 프로파일링</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>